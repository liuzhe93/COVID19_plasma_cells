#4fm9 is from RCSB
grep -v HOH 4fm9.pdb > 4fm9_rmWater.pdb 
grep -v GOL 4fm9_rmWater.pdb > 4fm9_rmLigand.pdb
grep -v MG 4fm9_rmLigand.pdb > 4fm9_clean.pdb
#remove other ligands by PyMOL
#4fm9_protein.pdb
gmx pdb2gmx -f 4fm9_protein.pdb -o 4fm9_processed.gro
#input 1 
#input 1
#BRD-K89997465 is from PubChem
#add H by Avogadro2 and saved as BRD.mol2
sed -i 's/UNL1/BRD/g' BRD.mol2
perl sort_mol2_bonds.pl BRD.mol2 BRDfix.mol2
#obtain topology file (BRDfix.str) of ligand(BRD) from https://cgenff.umaryland.edu/
python cgenff_charmm2gmx_py3_nx2.py BRD BRDfix.mol2 BRDfix.str charmm36_ljpme-jul2021.ff/
gmx editconf -f brd_ini.pdb -o brd.gro
cp 4fm9_processed.gro complex.gro
gmx editconf -f complex.gro -o newbox.gro -bt dodecahedron -d 1.0
gmx solvate -cp newbox.gro -cs spc216.gro -p topol.top -o solv.gro
gmx grompp -f ions.mdp -c solv.gro -p topol.top -o ions.tpr
gmx genion -s ions.tpr -o solv_ions.gro -p topol.top -pname SOD -nname CLA -neutral
#15
gmx grompp -f em.mdp -c solv_ions.gro -p topol.top -o em.tpr -maxwarn  7
gmx mdrun -v -deffnm em
gmx energy -f em.edr -o potential.xvg
#11
#0
gmx make_ndx -f brd.gro -o index_brd.ndx
#0 & ! a H*
gmx genrestr -f brd.gro -n index_brd.ndx -o posre_brd.itp -fc 1000 1000 1000
#3
gmx make_ndx -f em.gro -o index.ndx
#1|13
#14|15
gmx grompp -f nvt.mdp -c em.gro -r em.gro -p topol.top -n index.ndx -o nvt.tpr
gmx mdrun -deffnm nvt
gmx grompp -f npt.mdp -c nvt.gro -t nvt.cpt -r nvt.gro -p topol.top -n index.ndx -o  npt.tpr -maxwarn 100
gmx mdrun -deffnm npt






